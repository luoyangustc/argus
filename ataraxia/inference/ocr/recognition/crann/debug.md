export RUN_MODE=standalone

mkdir python/evals/modelfile
cd python/evals/modelfile
wget wget http://10.200.30.13:10000/ozp6ez3lb.com0.z0.glb.clouddn.com/ava-ocr-sari/ocr-sari-crann-20180607.tar
tar -xvf ocr-sari-crann-20180607.tar

cd ../../..
wget http://p24v9nypo.bkt.clouddn.com/005Zu0d2ly1fliuvdil2uj30hr1k1do7.jpg

import eval
import cv2

model = eval.create_net({"batch_size":1})
image = cv2.imread('005Zu0d2ly1fliuvdil2uj30hr1k1do7.jpg')
bboxes = [[15,888,564,894,563,933,14,926],[22,1788,582,1792,582,1833,21,1829],[19,1238,551,1242,551,1281,19,1277],[19,1688,530,1694,530,1732,19,1726],[4,1887,589,1892,589,1932,4,1928],[6,590,575,585,575,627,7,631],[13,838,595,841,595,881,13,878],[18,289,527,292,526,330,17,326],[22,1341,588,1338,588,1377,22,1381],[65,1038,518,1043,518,1080,65,1075],[23,1193,572,1188,573,1227,24,1232],[16,689,532,693,532,732,15,728],[23,637,562,641,562,681,23,676],[16,186,591,192,591,233,16,228],[28,1136,590,1140,589,1181,28,1177],[72,988,526,993,526,1031,71,1027],[8,537,574,542,573,582,8,577],[4,1388,588,1392,587,1432,4,1428],[14,437,331,440,330,483,13,479],[9,237,588,241,587,280,9,276],[29,1441,523,1438,523,1477,30,1480],[18,1591,589,1588,589,1628,18,1631],[23,1490,396,1492,395,1532,23,1529],[6,1637,566,1641,565,1681,5,1677],[29,1940,348,1945,347,1981,28,1976],[13,338,436,341,435,380,13,377],[5,1840,588,1844,588,1883,4,1879],[23,787,586,790,586,831,22,827]]
bboxes = list(map(lambda x:[[x[0],x[1]],[x[2],x[3]],[x[4],x[5]],[x[6],x[7]]],bboxes))
crann_recog = model[0]['crann_recog']

imglist = crann_recog.cutimagezz(image,bboxes)
predictions, text_bboxes = crann_recog.deploy(imglist)


curl -v -X POST -H "Authorization:QiniuStub uid=1&ut=2" -H "Content-Type:application/json" 127.0.0.1:43660/v1/eval -d '{ "data":{ "uri":"http://p24v9nypo.bkt.clouddn.com/005Zu0d2ly1fliuvdil2uj30hr1k1do7.jpg" }, "params": { "bboxes":[[15,888,564,894,563,933,14,926],[22,1788,582,1792,582,1833,21,1829],[19,1238,551,1242,551,1281,19,1277],[19,1688,530,1694,530,1732,19,1726],[4,1887,589,1892,589,1932,4,1928],[6,590,575,585,575,627,7,631],[13,838,595,841,595,881,13,878],[18,289,527,292,526,330,17,326],[22,1341,588,1338,588,1377,22,1381],[65,1038,518,1043,518,1080,65,1075],[23,1193,572,1188,573,1227,24,1232],[16,689,532,693,532,732,15,728],[23,637,562,641,562,681,23,676],[16,186,591,192,591,233,16,228],[28,1136,590,1140,589,1181,28,1177],[72,988,526,993,526,1031,71,1027],[8,537,574,542,573,582,8,577],[4,1388,588,1392,587,1432,4,1428],[14,437,331,440,330,483,13,479],[9,237,588,241,587,280,9,276],[29,1441,523,1438,523,1477,30,1480],[18,1591,589,1588,589,1628,18,1631],[23,1490,396,1492,395,1532,23,1529],[6,1637,566,1641,565,1681,5,1677],[29,1940,348,1945,347,1981,28,1976],[13,338,436,341,435,380,13,377],[5,1840,588,1844,588,1883,4,1879],[23,787,586,790,586,831,22,827]]}}'