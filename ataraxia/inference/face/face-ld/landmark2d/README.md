# Atlab Inference for Face-Landmark-2D&Pos-3D

## 将测试图片和模型放到相应位置下

    ```
    data/ 存放回归测试图片（>=1000）
    converter/model_tron/mobilenetv2_merged.tronmodel tron模型
    ```
 模型链接@:nihuajian@qiniu.com

[回归用例](http://p6yobdq7s.bkt.clouddn.com/landmarks/images.tar)

## 修改tron/examples and infer_detection测试脚本（分别对应算法回归测试，交付镜像回归测试）

    ```
    修改待测图片的文件filelist.txt和模型路径
    ```
![](tron/examples/example.jpg)

## 编译子工程Shadow及推理工程Tron
## 运行一键编译脚本

    ```
    ./scripts/build_shell.sh
    ```

## 运行

    ```
    ./build/tron/test_tron
    ```

## 输入人脸框格式，支持多张人脸输入
    
    ```
    {"detections":[{"pts":[[859.000000,238.000000],[1715.000000,238.000000],[1715.000000,1341.000000],[859.000000,1341.000000]]},{"pts":[[830.000000,208.000000],[1686.000000,208.000000],[1686.000000,1311.000000],[830.000000,1311.000000]]},{"pts":[[790.000000,220.000000],[1590.000000,220.000000],[1590.000000,1323.000000],[790.000000,1323.000000]]}]}

    ```

## 返回结果格式

    ```
    人脸ID：“index"，3D姿态："pos" ，68个点: "landmark"
    {"landmarks":[{"landmark":[[773.76806640625,837.3749389648438],[801.5050659179688,956.769287109375],[833.8480224609375,1072.88037109375],[883.93310546875,1182.7408447265626],[967.7660522460938,1263.8321533203126],[1088.652587890625,1311.5069580078126],[1230.126708984375,1327.97265625],[1369.736572265625,1328.25390625],[1498.9814453125,1320.4071044921876],[1600.857177734375,1298.1358642578126],[1666.2015380859376,1244.5693359375],[1709.3328857421876,1171.9090576171876],[1725.4371337890626,1084.1617431640626],[1727.2296142578126,991.9699096679688],[1723.6229248046876,907.7996826171875],[1709.5924072265626,835.1414794921875],[1689.5887451171876,767.8671875],[996.4793701171875,609.0869750976563],[1071.4808349609376,545.3822021484375],[1170.93798828125,512.0716552734375],[1277.80810546875,512.503173828125],[1372.788330078125,547.9029541015625],[1458.74560546875,567.82275390625],[1526.005615234375,551.6898193359375],[1596.6722412109376,562.659912109375],[1653.0205078125,599.7230224609375],[1675.776611328125,662.4729614257813],[1438.404541015625,621.1927490234375],[1460.45068359375,668.6087036132813],[1484.6488037109376,714.1571655273438],[1510.0062255859376,762.9180908203125],[1356.5281982421876,866.8699951171875],[1416.0355224609376,876.7057495117188],[1474.9991455078126,887.3094482421875],[1518.703857421875,880.6203002929688],[1555.7415771484376,870.8599243164063],[1116.49658203125,660.2716674804688],[1171.8115234375,631.2223510742188],[1226.7659912109376,631.4456787109375],[1276.9027099609376,666.78857421875],[1225.35791015625,667.3433837890625],[1170.1759033203126,665.3712158203125],[1499.921142578125,691.7322998046875],[1553.32763671875,669.1821899414063],[1601.568603515625,677.29638671875],[1635.3634033203126,713.392333984375],[1597.67431640625,711.5491333007813],[1549.25732421875,703.64453125],[1224.707763671875,1037.520263671875],[1328.0015869140626,977.640625],[1418.9051513671876,951.0834350585938],[1468.758056640625,963.0673217773438],[1515.7552490234376,956.3676147460938],[1568.908447265625,989.9577026367188],[1600.525390625,1053.87158203125],[1579.9244384765626,1072.0516357421876],[1514.4462890625,1071.270751953125],[1465.3515625,1070.5380859375],[1412.39404296875,1064.57861328125],[1325.0426025390626,1053.708740234375],[1252.736083984375,1032.8626708984376],[1416.5498046875,997.15576171875],[1467.294677734375,1001.294189453125],[1513.84521484375,1002.9141235351563],[1579.9197998046876,1043.333740234375],[1514.0218505859376,1025.597412109375],[1466.5966796875,1025.376708984375],[1415.4755859375,1021.4933471679688]],"pos":[23.46910858154297,-21.12443733215332,4.4188313484191898]},{"landmark":[[785.3675537109375,833.7186889648438],[807.7926025390625,950.8925170898438],[835.109130859375,1065.6241455078126],[880.244384765625,1173.3519287109376],[959.30224609375,1254.515869140625],[1074.48095703125,1303.7174072265626],[1212.196044921875,1322.1468505859376],[1350.2314453125,1323.005859375],[1478.254150390625,1314.81689453125],[1578.808349609375,1291.956298828125],[1641.8074951171876,1239.1102294921876],[1685.3546142578126,1168.767822265625],[1703.467041015625,1083.890380859375],[1707.60107421875,995.2540893554688],[1705.767822265625,913.7047119140625],[1691.609130859375,843.0020141601563],[1671.28759765625,778.2512817382813],[994.6014404296875,626.7813720703125],[1067.79638671875,561.8341064453125],[1166.3155517578126,524.416015625],[1273.0068359375,521.578857421875],[1369.3935546875,553.4168090820313],[1464.623291015625,573.8302001953125],[1528.574462890625,559.0333251953125],[1595.2109375,570.5155029296875],[1647.5643310546876,606.8507080078125],[1665.915771484375,669.0089721679688],[1437.4676513671876,626.7099609375],[1458.3927001953126,671.6807250976563],[1481.6661376953126,716.1110229492188],[1506.0213623046876,763.8928833007813],[1356.44921875,868.3104248046875],[1415.33544921875,876.6795043945313],[1472.4453125,885.904052734375],[1515.07275390625,879.9830932617188],[1550.6552734375,869.9421997070313],[1113.2391357421876,667.8179931640625],[1168.72705078125,638.2699584960938],[1224.2470703125,637.6451416015625],[1275.475830078125,672.8668212890625],[1223.2503662109376,674.5219116210938],[1167.457275390625,673.1512451171875],[1491.161376953125,696.4196166992188],[1544.502197265625,672.6377563476563],[1592.7967529296876,679.7474365234375],[1626.2177734375,716.1004028320313],[1589.5511474609376,715.2872314453125],[1541.06298828125,707.9159545898438],[1213.492919921875,1035.96826171875],[1318.7564697265626,980.598876953125],[1412.7655029296876,956.3468017578125],[1462.3782958984376,968.2398681640625],[1509.19970703125,961.462158203125],[1562.6395263671876,992.485595703125],[1593.2618408203126,1052.5067138671876],[1572.427490234375,1075.722412109375],[1504.9801025390626,1074.7294921875],[1455.94921875,1074.171142578125],[1403.0672607421876,1068.9517822265626],[1312.898681640625,1057.3114013671876],[1241.1685791015626,1032.4921875],[1410.2191162109376,998.0850830078125],[1460.618408203125,1002.4509887695313],[1507.0950927734376,1003.5943603515625],[1572.5010986328126,1043.945556640625],[1504.718505859375,1032.8360595703126],[1457.492919921875,1033.1739501953126],[1406.9019775390626,1029.845458984375]],"pos":[17.93290138244629,-19.9905948638916,2.594823122024536]},{"landmark":[[776.3173828125,822.16064453125],[802.5894775390625,938.7385864257813],[834.8046875,1055.75634765625],[885.895751953125,1164.912841796875],[972.421875,1245.3946533203126],[1093.35888671875,1295.3770751953126],[1233.21484375,1316.849853515625],[1373.7132568359376,1318.06689453125],[1498.8194580078126,1308.337158203125],[1591.688720703125,1280.853271484375],[1645.848876953125,1223.388427734375],[1680.6497802734376,1150.5794677734376],[1695.82470703125,1066.817626953125],[1700.7103271484376,981.3168334960938],[1698.7757568359376,901.7195434570313],[1683.4454345703126,830.4558715820313],[1661.3531494140626,766.0275268554688],[978.8485717773438,621.1141967773438],[1048.8779296875,555.9302978515625],[1145.70068359375,515.5363159179688],[1251.2174072265626,512.9927978515625],[1346.9013671875,545.0824584960938],[1466.0869140625,564.966552734375],[1526.7244873046876,550.6320190429688],[1591.140380859375,561.1575927734375],[1642.1893310546876,598.8478393554688],[1657.0009765625,661.9891967773438],[1430.330810546875,632.5985107421875],[1454.3883056640626,679.9976806640625],[1481.2666015625,726.1676025390625],[1509.8828125,775.5367431640625],[1359.614501953125,873.5889282226563],[1418.0826416015626,880.8732299804688],[1473.8004150390626,888.8955688476563],[1513.7276611328126,883.2346801757813],[1546.3154296875,872.7274169921875],[1108.193603515625,664.9207153320313],[1164.4591064453126,631.99462890625],[1221.3040771484376,632.487060546875],[1271.156005859375,673.4315795898438],[1219.9329833984376,674.8701171875],[1162.83447265625,672.6702880859375],[1475.565185546875,697.4496459960938],[1528.213623046875,668.388916015625],[1577.819580078125,674.2994384765625],[1610.55224609375,713.2568969726563],[1576.7982177734376,715.1499633789063],[1527.2391357421876,708.8779296875],[1216.880859375,1031.763427734375],[1324.292236328125,983.845703125],[1417.5614013671876,961.9299926757813],[1465.1024169921876,973.0939331054688],[1509.565673828125,964.7478637695313],[1560.0302734375,990.466064453125],[1590.0675048828126,1040.4580078125],[1564.8538818359376,1064.202880859375],[1509.9749755859376,1067.960205078125],[1463.399169921875,1069.133056640625],[1412.55615234375,1065.755859375],[1322.2567138671876,1055.5556640625],[1244.153076171875,1029.156494140625],[1416.255126953125,1002.3792114257813],[1464.610595703125,1005.86181640625],[1508.9647216796876,1004.9591674804688],[1568.356201171875,1034.925048828125],[1508.6920166015626,1026.79638671875],[1463.80517578125,1028.964111328125],[1415.286865234375,1027.8074951171876]],"pos":[14.992176055908204,-21.90558433532715,3.1781797409057619]}]}

    ```

## 使用心得
一定要做多张图片的回归测试
